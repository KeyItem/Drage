using System.Collections;
using UnityEngine;
using Rewired;

public class InputManager2D : MonoBehaviour
{
    private Player playerInput;

    private PlayerController2D playerController;

    [Header("Player Input Attributes")]
    public float xAxisInput;
    public float yAxisInput;

    private Vector2 inputVector;

    [Space(10)]
    public float xAxisRawInput;
    public float yAxisRawInput;

    [Space(10)]
    private Vector2 inputDirectionVector;

    private bool canReceiveInput = true;

    private bool isInputInitialized = false;

    private void Start()
    {
        InputSetup();
    }

    private void Update()
    {
        GetInput();
    }

    private void InputSetup()
    {
        playerInput = ReInput.players.GetPlayer(0);

        playerController = GetComponent<PlayerController2D>();

        isInputInitialized = true;
    }

    private void GetInput()
    {
        if (isInputInitialized)
        {
            if (canReceiveInput)
            {
                xAxisInput = playerInput.GetAxis("HorizontalAxis");
                yAxisInput = playerInput.GetAxis("VerticalAxis");

                inputVector.Set(xAxisInput, yAxisInput);

                xAxisRawInput = playerInput.GetAxisRaw("HorizontalAxis");
                yAxisRawInput = playerInput.GetAxisRaw("VerticalAxis");

                inputDirectionVector = ReturnInputDirectionVector(xAxisRawInput, yAxisRawInput);

                if (playerInput.GetButtonDown("Jump"))
                {
                    playerController.PlayerJump();
                }
                if (playerInput.GetButtonUp("Jump"))
                {
                    playerController.PlayerJumpEarlyRelease();
                }

                if (playerInput.GetButtonDown("Dash"))
                {
                    playerController.PlayerDash();
                }

                if (playerInput.GetButtonDown("Sprint"))
                {
                    playerController.StartSprint();
                }

                if (playerInput.GetButtonUp("Sprint"))
                {
                    playerController.StopSprint();
                }

                if (playerInput.GetButtonDown("Attack"))
                {
                    playerController.PlayerAttack();
                }

                if (playerInput.GetButtonDown("Reset"))
                {
                    playerController.ResetController();
                }

                playerController.ReceiveInputData(inputVector, inputDirectionVector);
            }
        }
    }

    private Vector2 ReturnInputDirectionVector(float inputXAxis, float inputYAxis)
    {
        Vector2 modifiedInputDirectionVector = Vector2.zero;

        if (inputXAxis != 0)
        {
            modifiedInputDirectionVector.x = Mathf.Sign(inputXAxis);
        }
        else
        {
            modifiedInputDirectionVector.x = 0;
        }

        if (inputYAxis != 0)
        {
            modifiedInputDirectionVector.y = Mathf.Sign(inputYAxis);
        }
        else
        {
            modifiedInputDirectionVector.y = 0;
        }

        return modifiedInputDirectionVector;
    }
}
